<div class="deployment-manager-container d-flex h-100">
  <!-- Configuration and Selection Sidebar -->
  <div
    class="deployment-sidebar border-end d-flex flex-row"
    [class.d-none]="!configurationVisible() && !runsListVisible()"
    [class.mobile-overlay]="configurationVisible() || runsListVisible()"
  >
    @if (clientId() && agentId()) {
      <!-- Configuration Section -->
      @if (configurationVisible()) {
        <div class="deployment-configuration-wrapper flex-shrink-0 border-end">
          <div class="p-3 border-bottom bg-body-tertiary">
            <div class="d-flex align-items-center justify-content-between">
              <h5 class="mb-0 fw-semibold">Deployment Configuration</h5>
              <button
                type="button"
                class="btn btn-sm btn-secondary d-block d-md-none"
                (click)="configurationVisible.set(false)"
                title="Close Configuration"
              >
                <i class="bi bi-x"></i>
              </button>
            </div>
          </div>
          <div class="flex-grow-1 overflow-auto">
            <framework-deployment-configuration
              [clientId]="clientId()!"
              [agentId]="agentId()!"
              (configurationSaved)="onConfigurationSaved($event)"
              (configurationDeleted)="onConfigurationDeleted()"
              (repositorySelected)="onRepositorySelected($event)"
              (branchSelected)="onBranchSelected($event)"
              (workflowSelected)="onWorkflowSelected($event)"
              (triggerWorkflow)="onTriggerWorkflow($event.workflow, $event.branch, $event.inputs)"
            ></framework-deployment-configuration>
          </div>
        </div>
      }

      <!-- Runs List Section -->
      @if (runsListVisible()) {
        <div class="deployment-runs-wrapper flex-shrink-0">
          <div class="p-3 border-bottom bg-body-tertiary flex-shrink-0">
            <div class="d-flex align-items-center justify-content-between">
              <h5 class="mb-0 fw-semibold">Deployment Runs</h5>
              <div class="d-flex align-items-center gap-2">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary"
                  (click)="onRefreshRuns()"
                  [disabled]="loadingRuns$ | async"
                  title="Refresh Runs"
                >
                  @if (loadingRuns$ | async) {
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  } @else {
                    <i class="bi bi-arrow-clockwise"></i>
                  }
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-secondary d-block d-md-none"
                  (click)="runsListVisible.set(false)"
                  title="Close Runs List"
                >
                  <i class="bi bi-x"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-grow-1 overflow-auto" style="min-height: 0">
            <framework-deployment-runs-list
              [clientId]="clientId()!"
              [agentId]="agentId()!"
              [selectedRunId]="selectedRunId()"
              (runSelected)="onRunSelected($event)"
            ></framework-deployment-runs-list>
          </div>
        </div>
      }
    } @else {
      <div class="d-flex justify-content-center align-items-center h-100 p-4">
        <div class="text-center text-muted">
          <i class="bi bi-exclamation-triangle fs-4 d-block mb-2"></i>
          <p class="mb-0 small">Please select a workspace and agent</p>
        </div>
      </div>
    }
  </div>

  <!-- Main Content Area -->
  <div class="deployment-content flex-grow-1 d-flex flex-column">
    @if (runDetailsVisible() && selectedRunSignal()) {
      <div class="deployment-run-details-wrapper flex-grow-1 d-flex flex-column">
        <div class="p-3 border-bottom bg-body-tertiary flex-shrink-0">
          <div class="d-flex align-items-center justify-content-between">
            <h5 class="mb-0 fw-semibold">Run Details</h5>
            <button
              type="button"
              class="btn btn-sm btn-secondary"
              (click)="onCloseRunDetails()"
              title="Close Run Details"
            >
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>
        <div class="flex-grow-1 overflow-auto" style="min-height: 0">
          <framework-deployment-run-details
            [clientId]="clientId()!"
            [agentId]="agentId()!"
            [runId]="selectedRunId()!"
          ></framework-deployment-run-details>
        </div>
      </div>
    } @else {
      <div class="d-flex justify-content-center align-items-center h-100 bg-body-secondary">
        <div class="text-center text-muted p-4">
          <i class="bi bi-rocket-takeoff fs-1 d-block mb-3"></i>
          <p class="mb-0">No run selected</p>
          <small class="text-muted">Select a run from the list to view details</small>
        </div>
      </div>
    }
  </div>
</div>
