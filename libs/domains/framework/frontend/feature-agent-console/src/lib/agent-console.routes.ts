import { Route } from '@angular/router';
import {
  AgentsFacade,
  agentsReducer,
  authenticationReducer,
  cancelRun$,
  checkAuthentication$,
  ClientsFacade,
  clientsReducer,
  commit$,
  connectSocket$,
  createBranch$,
  createClient$,
  createClientAgent$,
  createDeploymentConfiguration$,
  createFileOrDirectory$,
  deleteBranch$,
  deleteClient$,
  deleteClientAgent$,
  deleteDeploymentConfiguration$,
  deleteFileOrDirectory$,
  deleteProvisionedServer$,
  DeploymentsFacade,
  deploymentsReducer,
  disconnectSocket$,
  fetch$,
  FilesFacade,
  filesReducer,
  listDirectory$,
  loadBranches$,
  loadClient$,
  loadClientAgent$,
  loadClientAgentCommandsFromFiles$,
  loadClientAgentCommandsLoading$,
  loadClientAgents$,
  loadClientAgentsBatch$,
  loadClients$,
  loadClientsBatch$,
  loadDeploymentConfiguration$,
  loadRuns$,
  loadGitBranches$,
  loadGitDiff$,
  loadGitStatus$,
  loadJobLogs$,
  loadProvisioningProviders$,
  loadRepositories$,
  loadRunJobs$,
  loadRunLogs$,
  loadRunStatus$,
  loadServerInfo$,
  loadServerInfoAfterProvisioning$,
  loadServerTypes$,
  loadWorkflows$,
  login$,
  loginSuccessRedirect$,
  logout$,
  logoutSuccessRedirect$,
  moveFileOrDirectory$,
  processContainerStats$,
  provisionServer$,
  pull$,
  push$,
  readFile$,
  rebase$,
  resolveConflict$,
  restoreAgentLogin$,
  restoreClientContext$,
  setActiveClient$,
  SocketsFacade,
  socketsReducer,
  stageFiles$,
  StatsFacade,
  statsReducer,
  switchBranch$,
  triggerWorkflow$,
  unstageFiles$,
  updateClient$,
  updateClientAgent$,
  updateDeploymentConfiguration$,
  VcsFacade,
  vcsReducer,
  writeFile$,
} from '@forepath/framework/frontend/data-access-agent-console';
import { provideEffects } from '@ngrx/effects';
import { provideState } from '@ngrx/store';
import { provideMonacoEditor } from 'ngx-monaco-editor-v2';
import { AgentConsoleChatComponent } from './chat/chat.component';
import { AgentConsoleContainerComponent } from './container/container.component';
import { authGuard } from './guards/auth.guard';
import { loginGuard } from './guards/login.guard';
import { AgentConsoleLoginComponent } from './login/login.component';

export const agentConsoleRoutes: Route[] = [
  {
    path: '',
    component: AgentConsoleContainerComponent,
    children: [
      {
        path: '',
        pathMatch: 'full',
        redirectTo: 'clients',
      },
      {
        path: 'login',
        component: AgentConsoleLoginComponent,
        canActivate: [loginGuard],
        title: 'Login | Agenstra',
      },
      {
        path: 'clients',
        canActivate: [authGuard],
        title: 'Manager | Agenstra',
        children: [
          {
            path: '',
            component: AgentConsoleChatComponent,
            pathMatch: 'full',
          },
          {
            path: ':clientId',
            component: AgentConsoleChatComponent,
            pathMatch: 'full',
          },
          {
            path: ':clientId/agents/:agentId',
            component: AgentConsoleChatComponent,
            pathMatch: 'full',
          },
          {
            path: ':clientId/agents/:agentId/editor',
            component: AgentConsoleChatComponent,
            pathMatch: 'full',
          },
          {
            path: ':clientId/agents/:agentId/deployments',
            component: AgentConsoleChatComponent,
            pathMatch: 'full',
          },
        ],
      },
      {
        path: '**',
        redirectTo: 'clients',
      },
    ],
    providers: [
      // Facades
      AgentsFacade,
      ClientsFacade,
      SocketsFacade,
      FilesFacade,
      VcsFacade,
      StatsFacade,
      DeploymentsFacade,
      // Feature states - registered at feature level for lazy loading
      provideState('clients', clientsReducer),
      provideState('agents', agentsReducer),
      provideState('sockets', socketsReducer),
      provideState('authentication', authenticationReducer),
      provideState('files', filesReducer),
      provideState('vcs', vcsReducer),
      provideState('stats', statsReducer),
      provideState('deployments', deploymentsReducer),
      // Effects - only active when this feature route is loaded
      provideEffects({
        loadClients$,
        loadClientsBatch$,
        loadClient$,
        createClient$,
        updateClient$,
        deleteClient$,
        setActiveClient$,
        loadProvisioningProviders$,
        loadServerTypes$,
        provisionServer$,
        loadServerInfo$,
        loadServerInfoAfterProvisioning$,
        deleteProvisionedServer$,
        loadClientAgents$,
        loadClientAgentsBatch$,
        loadClientAgent$,
        loadClientAgentCommandsLoading$,
        loadClientAgentCommandsFromFiles$,
        createClientAgent$,
        updateClientAgent$,
        deleteClientAgent$,
        connectSocket$,
        disconnectSocket$,
        restoreClientContext$,
        restoreAgentLogin$,
        login$,
        loginSuccessRedirect$,
        logout$,
        logoutSuccessRedirect$,
        checkAuthentication$,
        readFile$,
        writeFile$,
        listDirectory$,
        createFileOrDirectory$,
        deleteFileOrDirectory$,
        moveFileOrDirectory$,
        loadGitStatus$,
        loadGitBranches$,
        loadGitDiff$,
        stageFiles$,
        unstageFiles$,
        commit$,
        push$,
        pull$,
        fetch$,
        rebase$,
        switchBranch$,
        createBranch$,
        deleteBranch$,
        resolveConflict$,
        processContainerStats$,
        loadDeploymentConfiguration$,
        createDeploymentConfiguration$,
        updateDeploymentConfiguration$,
        deleteDeploymentConfiguration$,
        loadRepositories$,
        loadBranches$,
        loadWorkflows$,
        loadRuns$,
        triggerWorkflow$,
        loadRunStatus$,
        loadRunLogs$,
        cancelRun$,
        loadRunJobs$,
        loadJobLogs$,
      }),
      provideMonacoEditor(),
    ],
  },
];
