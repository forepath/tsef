flowchart TB
    subgraph HTTP["ğŸ”· HTTP REST API (/api/clients)"]
        direction TB
        HTTP_USE["Use Case: Client Management<br/>One-time Requests<br/>Request-Response Pattern"]
        HTTP_USE --> HTTP1["ğŸ“ Create Client<br/>POST /api/clients<br/>Returns: Client + API Key (if API_KEY)"]
        HTTP_USE --> HTTP2["ğŸ“‹ List Clients<br/>GET /api/clients?limit&offset<br/>Returns: Paginated List"]
        HTTP_USE --> HTTP3["ğŸ” Get Client<br/>GET /api/clients/:id<br/>Returns: Client Details"]
        HTTP_USE --> HTTP4["âœï¸ Update Client<br/>POST /api/clients/:id<br/>Returns: Updated Client"]
        HTTP_USE --> HTTP5["ğŸ—‘ï¸ Delete Client<br/>DELETE /api/clients/:id<br/>Returns: 204 No Content"]
    end

    subgraph PROXY["ğŸ”· HTTP REST API - Proxied Agent Operations (/api/clients/:id/agents)"]
        direction TB
        PROXY_USE["Use Case: Agent Management via Client<br/>Proxy to Remote Agent-Manager<br/>Request-Response Pattern"]
        PROXY_USE --> PROXY1["ğŸ“ Create Agent (Proxied)<br/>POST /api/clients/:id/agents<br/>Returns: Agent + Password<br/>Saves credentials for WS"]
        PROXY_USE --> PROXY2["ğŸ“‹ List Agents (Proxied)<br/>GET /api/clients/:id/agents?limit&offset<br/>Returns: Paginated Agent List"]
        PROXY_USE --> PROXY3["ğŸ” Get Agent (Proxied)<br/>GET /api/clients/:id/agents/:agentId<br/>Returns: Agent Details"]
        PROXY_USE --> PROXY4["âœï¸ Update Agent (Proxied)<br/>POST /api/clients/:id/agents/:agentId<br/>Returns: Updated Agent"]
        PROXY_USE --> PROXY5["ğŸ—‘ï¸ Delete Agent (Proxied)<br/>DELETE /api/clients/:id/agents/:agentId<br/>Returns: 204 No Content"]
    end

    subgraph FILES["ğŸ“ HTTP REST API - Proxied File System (/api/clients/:id/agents/:agentId/files)"]
        direction TB
        FILES_USE["Use Case: File System Operations via Client<br/>Proxy to Remote Agent-Manager<br/>Request-Response Pattern"]
        FILES_USE --> FILES1["ğŸ“– Read File (Proxied)<br/>GET /api/clients/:id/agents/:agentId/files/*path<br/>Returns: File Content (base64)"]
        FILES_USE --> FILES2["âœï¸ Write File (Proxied)<br/>PUT /api/clients/:id/agents/:agentId/files/*path<br/>Returns: 204 No Content"]
        FILES_USE --> FILES3["ğŸ“‚ List Directory (Proxied)<br/>GET /api/clients/:id/agents/:agentId/files?path=<br/>Returns: File Nodes"]
        FILES_USE --> FILES4["â• Create File/Dir (Proxied)<br/>POST /api/clients/:id/agents/:agentId/files/*path<br/>Returns: 201 Created"]
        FILES_USE --> FILES5["ğŸ—‘ï¸ Delete File/Dir (Proxied)<br/>DELETE /api/clients/:id/agents/:agentId/files/*path<br/>Returns: 204 No Content"]
    end

    subgraph ENV["ğŸŒ HTTP REST API - Proxied Environment Variables (/api/clients/:id/agents/:agentId/environment)"]
        direction TB
        ENV_USE["Use Case: Environment Variable Management via Client<br/>Proxy to Remote Agent-Manager<br/>Request-Response Pattern"]
        ENV_USE --> ENV1["ğŸ“‹ List Environment Variables (Proxied)<br/>GET /api/clients/:id/agents/:agentId/environment?limit&offset<br/>Returns: Paginated Environment Variables"]
        ENV_USE --> ENV2["ğŸ”¢ Count Environment Variables (Proxied)<br/>GET /api/clients/:id/agents/:agentId/environment/count<br/>Returns: Count"]
        ENV_USE --> ENV3["â• Create Environment Variable (Proxied)<br/>POST /api/clients/:id/agents/:agentId/environment<br/>Returns: Created Environment Variable"]
        ENV_USE --> ENV4["âœï¸ Update Environment Variable (Proxied)<br/>PUT /api/clients/:id/agents/:agentId/environment/:envVarId<br/>Returns: Updated Environment Variable"]
        ENV_USE --> ENV5["ğŸ—‘ï¸ Delete Environment Variable (Proxied)<br/>DELETE /api/clients/:id/agents/:agentId/environment/:envVarId<br/>Returns: 204 No Content"]
        ENV_USE --> ENV6["ğŸ—‘ï¸ Delete All Environment Variables (Proxied)<br/>DELETE /api/clients/:id/agents/:agentId/environment<br/>Returns: Deleted Count"]
    end

    subgraph WS["ğŸ”¶ WebSocket Gateway (namespace: /clients)"]
        direction TB
        WS_USE["Use Case: Real-time Event Forwarding<br/>Bidirectional Messages<br/>Persistent Connection"]
        WS_USE --> WS1["ğŸ” Client Context Setup<br/>1. Connect to WebSocket<br/>2. setClient with clientId<br/>3. Remote connection established<br/>4. Auto-authentication (API_KEY/Keycloak)"]
        WS_USE --> WS2["ğŸ“¤ Event Forwarding<br/>1. forward event with agentId?<br/>2. Auto-login if agentId provided<br/>3. Forward to remote agent-manager WS<br/>4. Relay responses back to client"]
    end

    Start([Agent Controller Feature]) --> HTTP
    Start --> PROXY
    Start --> FILES
    Start --> ENV
    Start --> WS

    HTTP -.->|"Stateless<br/>Request-Response"| HTTP_USE
    PROXY -.->|"Proxy to Remote<br/>Agent-Manager"| PROXY_USE
    FILES -.->|"Proxy to Remote<br/>Agent-Manager"| FILES_USE
    ENV -.->|"Proxy to Remote<br/>Agent-Manager"| ENV_USE
    WS -.->|"Stateful<br/>Persistent Connection"| WS_USE

    style HTTP fill:#e6f0ff,stroke:#4a90e2,stroke-width:3px
    style PROXY fill:#e6f0ff,stroke:#4a90e2,stroke-width:3px
    style FILES fill:#e6ffe6,stroke:#4a9e2,stroke-width:3px
    style ENV fill:#fff0e6,stroke:#ff6b42,stroke-width:3px
    style WS fill:#fff4e6,stroke:#ff8c42,stroke-width:3px
    style HTTP_USE fill:#d6e9ff,stroke:#4a90e2
    style PROXY_USE fill:#d6e9ff,stroke:#4a90e2
    style FILES_USE fill:#d6ffd6,stroke:#4a9e2
    style ENV_USE fill:#ffe6d6,stroke:#ff6b42
    style WS_USE fill:#ffe6cc,stroke:#ff8c42
    style HTTP1 fill:#f0f7ff,stroke:#4a90e2
    style HTTP2 fill:#f0f7ff,stroke:#4a90e2
    style HTTP3 fill:#f0f7ff,stroke:#4a90e2
    style HTTP4 fill:#f0f7ff,stroke:#4a90e2
    style HTTP5 fill:#f0f7ff,stroke:#4a90e2
    style PROXY1 fill:#f0f7ff,stroke:#4a90e2
    style PROXY2 fill:#f0f7ff,stroke:#4a90e2
    style PROXY3 fill:#f0f7ff,stroke:#4a90e2
    style PROXY4 fill:#f0f7ff,stroke:#4a90e2
    style PROXY5 fill:#f0f7ff,stroke:#4a90e2
    style FILES1 fill:#f0fff0,stroke:#4a9e2
    style FILES2 fill:#f0fff0,stroke:#4a9e2
    style FILES3 fill:#f0fff0,stroke:#4a9e2
    style FILES4 fill:#f0fff0,stroke:#4a9e2
    style FILES5 fill:#f0fff0,stroke:#4a9e2
    style ENV1 fill:#fff5f0,stroke:#ff6b42
    style ENV2 fill:#fff5f0,stroke:#ff6b42
    style ENV3 fill:#fff5f0,stroke:#ff6b42
    style ENV4 fill:#fff5f0,stroke:#ff6b42
    style ENV5 fill:#fff5f0,stroke:#ff6b42
    style ENV6 fill:#fff5f0,stroke:#ff6b42
    style WS1 fill:#fff9f0,stroke:#ff8c42
    style WS2 fill:#fff9f0,stroke:#ff8c42
