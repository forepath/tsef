# This file is generated by Nx.
# Build the docker image with `npx nx docker:build frontend-agent-console`.
# Tip: Modify "docker:build" options in project.json to change docker build args.
#
# Run the container with `nx docker:run frontend-agent-console -p 4200:4200`.
#
FROM docker.io/debian:trixie

# Environment variables for the frontend server
ENV HOST=0.0.0.0
ENV PORT=4200
ENV NODE_ENV=production
ENV DEFAULT_LOCALE=en

WORKDIR /app
EXPOSE ${PORT}

# Copy application code
COPY . /app

# Install required dependencies
RUN apt-get update && apt-get install -y curl bash ca-certificates && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Install Node.js via nvm
ENV NVM_DIR=/root/.nvm
ENV NODE_VERSION=22.12.0

RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash \
  && . $NVM_DIR/nvm.sh \
  && nvm install $NODE_VERSION \
  && nvm alias default $NODE_VERSION \
  && nvm use default \
  && echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bashrc \
  && echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"' >> ~/.bashrc \
  && echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"' >> ~/.bashrc

# Install dependencies
RUN . $NVM_DIR/nvm.sh && npm ci

# Start the application
CMD ["/bin/bash", "-c", ". $NVM_DIR/nvm.sh && node server.cjs"]
