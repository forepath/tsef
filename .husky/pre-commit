#!/bin/bash

# Pre-commit hook for TSEF Nx monorepo
# This hook runs before each commit to ensure code quality and consistency

echo "ğŸ” Running pre-commit checks..."

# 1. Check code formatting with Prettier
echo "ğŸ“ Checking code formatting with Prettier..."
nx format:check
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting check failed. Please run 'nx format:write' to fix formatting issues."
  exit 1
fi

# 2. Run linting on affected projects
echo "ğŸ”§ Running ESLint on affected projects..."
nx affected -t lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed. Please fix linting errors."
  exit 1
fi

# 3. Run tests on affected projects
echo "ğŸ§ª Running tests on affected projects..."
nx affected -t test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix failing tests."
  exit 1
fi

# 4. Build affected projects to ensure they compile
echo "ğŸ—ï¸  Building affected projects..."
nx affected -t build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix build errors."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
