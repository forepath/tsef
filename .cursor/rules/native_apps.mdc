---
globs: "**/capacitor.config.ts, **/*.native.ts, **/*.ios.ts, **/*.android.ts"
alwaysApply: false
---

# Native Apps Rules (Capacitor / Platform Code)

This ruleset governs native-layer TypeScript shims, Capacitor configuration, and platform-specific files.

> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are as described in RFC 2119.

## Configuration & Plugins

- `capacitor.config.ts` **MUST** define environment-specific settings without hardcoding secrets.
- Plugin bridges **MUST** be typed and validate inputs/outputs.

## Platform-Specific Code

- Files suffixed with `.ios.ts` / `.android.ts` **MUST** only include platform-differentiated logic.
- Shared logic **SHOULD** live in platform-agnostic modules reused by both platforms.

## Permissions & Security

- Native capabilities **MUST** request only required permissions and declare them explicitly.
- Sensitive data **MUST** be stored using secure storage and transmitted over HTTPS.

## Error Handling

- Native calls **SHOULD** include timeouts and clear error messages mapped to domain errors.

## Testing

- Platform-specific logic **SHOULD** be wrapped for unit testing; maintain feature flags for behavior parity.

## Examples

```ts
// capacitor.config.ts
import { CapacitorConfig } from '@capacitor/cli';

export const config: CapacitorConfig = {
  appId: 'com.example.app',
  appName: 'Example',
  webDir: 'dist',
  server: { url: process.env.APP_SERVER_URL, cleartext: false },
};
```

```ts
// platform.native.ts (wrapper around Capacitor APIs)
export async function getDeviceInfoSafe(): Promise<{ model: string; os: string }> {
  try {
    const info = await Device.getInfo();
    return { model: info.model ?? 'unknown', os: info.operatingSystem };
  } catch {
    return { model: 'unknown', os: 'web' };
  }
}
```
